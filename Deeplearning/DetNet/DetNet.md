# DetNet：一种用于目标检测的Backbone 网络

## 摘要

- 近期基于 CNN 的目标检测器，无论是 one-stage （仅需一个步骤，端到端）的方法，例如 YOLO、SSD、Retina Network，还是 two-stage（需要两个步骤）的方法，例如 Faster R-CNN、R-FCN、FPN，都试图在用于分类的 ImageNet 预训练模型上进行微调。很少有工作讨论专门用于目标检测的 Backbone 特征提取器。
- 更重要的是，图像分类任务和目标检测任务之间确实存在诸多不同之处。
  - 近期的目标检测器，例如 FPN 和 RetinaNet，通常引入与图像分类任务不同的额外步骤来处理多尺度的目标。
  - 目标检测不仅需要识别出目标所处的分类，而且需要确定其空间位置。较大的降采样因子扩大了有效识别范围，对于图像分类任务来说是有益的，但是牺牲了一部分目标定位能力。
- 由于图像分类与目标检测之间存在差异，本文提出了 DetNet，一种专门为目标检测设计的 Backbone 网络。DetNet 包含了与用于图像分类的传统网络架构不同的额外步骤，同时也在更深的层中保留了较高的空间分辨率。在 COCO 数据集上目标检测和实例分割任务上，DetNet 得到了最先进的结果。

## 1 引言

- 目标检测是计算机视觉中最基础的任务之一。随着深度卷积神经网络的快速发展，目标检测的性能有了明显提高。
- 使用分类网络作为目标检测的预训练模型的弊端，主要内容与摘要类似。
- 一个设计优秀的 Backbone 网络应该解决上述所有问题。在本文中，我们提出了 DetNet，一种专门为目标检测设计的 Backbone 网络。进一步来说，由于目标尺度的多样化， DetNet 引入了FPN等目标检测器中使用的步骤。与来自于 ImageNet 分类问题的传统预训练模型不同，即使加入了额外步骤，我们仍旧保持了特征的空间分辨率。然而，由于卷积运算和内存消耗，高分辨率的特征映射为构建深度神经网络带来了新的挑战。为了保持 DetNet 的效率，我们选用了一种低复杂度的扩张瓶颈（dialated bottleneck）结构。通过结合这些举措，我们的 DetNet 不仅保持了高分辨率的特征映射，还具有更大的识别范围，这对于目标检测任务来说都是至关重要的。
- 总的来说，我们主要完成了以下工作：
  - 我们第一个分析了用于近期的目标检测器微调的预训练模型的弊端。
  - 我们提出了一种名为 DetNet 的先进的 Backbone 网络，这种 Backbone 网络是为目标检测任务专门设计的，可以保持较高的空间分辨率，扩大识别范围。
  - 我们基于低复杂度的 DetNet-59 架构在 COCO 数据集的目标检测和实例分割任务上取得了最先进的结果。

## 2 相关工作

- 目标检测是计算机视觉领域的热门研究主题。它的目标是在得到一张图像后找到每个目标实例的位置和分类。传统的目标检测器使用手工设计的目标组成描述子提取图像特征，例如 HOG、SIFT 、Selective Search 、Edge Box。在很长的一段时间内，DPM和它的变种在目标检测领域占据主导地位。随着深度卷积神经网络的快速发展，基于 CNN 的目标检测器成为了目标检测领域的新潮流。
- 在网络结构上，近期的基于 CNN 的检测器通常可以分为两个部分。一部分是 Backbone 网络，另一部分用于检测。我们对这两部分的简要介绍如下。

### 2.1 Backbone 网络

- 用于目标检测的 Backbone 网络通常来自于 ImageNet 分类网络。在过去的几年中，  ImageNet 被认为是用于评估深度卷积网络能力的最权威的数据集。许多新的网络的设计目的就是在 ImageNet 数据集上获得更好的表现。
  - AlexNet 第一个尝试了增加 CNN 的深度。为了降低网络的计算量和增加感受范围，AlexNet 对特征映射进行步长为 $32$ 的降采样，这也成为了后续工作中的标准设置。
  - VGGNet 对 $3 \times 3$ 卷积运算进行堆叠构建了更深的网络，同时仍对特征映射采用步长为 $32$ 的降采样。大多数后续的研究都采用了类似的结构，以降采样将网络分为多个阶段，为每个阶段设计更好的组件。
  - GoogLeNet 提出了一种新的 inception block 来包含更多种类的特征。
  - ResNet 采用了一种“瓶颈”设计，同时在每个阶段中使用剩余加和操作，这种方法被证明是一种构建更深的神经网络的简单、有效的方法。
  - ResNet 和 Xception 使用一组卷积层来代替传统的卷积层。这种方法在减少参数数量的同时增加了准确度。
  - DenseNet 密集地将几个层连接起来，更大程度地降低了参数数量，同时保持着有竞争力的准确度。
  - Dilated Residual Network 使用更小的步长来提取特征。
  - DRN在分割方面取得了显着成果，但很少讨论对象检测。
- 还有许多对高效 Backbone 的研究，然而它们通常也是为分类问题设计的。

### 2.2 目标检测相关部分

- 目标检测相关部分往往与基础模型相连接，这些基础模型是为 ImageNet 分类问题而设计和训练的。目前有两种不同的目标检测设计逻辑。

  - 一种是 one-stage 检测器，这种检测器直接使用 backbone 来进行目标实例预测。
    - YOLO 使用一个名为 DarkNet 的简单、高效的 backbone，之后简单地将检测视为一个回归问题。
    - SSD 采用简化的 VGGNet 作为 backbone，并从多个层中提取特征，这使得网络能够更好地处理多种目标尺度。
    - RetinaNet 使用 ResNet 作为一个简单的特征提取器，之后采用 “Focal” 损失来解决由极端的前景-背景长宽比带来的分类不平衡问题。
  - 另一种是 two-stage 检测器。特别地，近期的 two-stage 检测器首先根据 backbone 预测多个建议，之后使用另外一个分类器来对建议进行分类和回归。
    - Faster R-CNN 通过区域推荐网络（RPN）直接从 backbone 中生成建议。
    - R-FCN 从 backbone 的输出中产生与位置相关的特征映射，之后使用一种名为位置相关池化的新的池化方法处理每个建议。
    - Deformable convolution Network 尝试通过不使用监督学习额外的偏置，将卷积操作与几何变换结合起来。这是首个为目标检测任务改善 backbone 的例子。
    - Feature Pyramid Network 通过深度卷积网络固有的多尺度、金字塔结构来构建特征金字塔。特别地，FPN 使用 U形结构来结合多个层的输出。并且仍使用传统的 ResNet 作为 backbone 网络，而没有进行更深层次的研究。
    - DSOD 首次提出从头训练检测任务，这个方法的结果比预训练方法的更差。

- 结论是，传统的 backbone 通常为 ImageNet 分类问题而设计。最适合目标检测任务的 backbone 形式仍然是未研究的领域。最近的目标检测器，无论是 one-stage 还是 two-stage，都使用 ImageNet 分类问题的预训练模型，这并非是提高目标检测性能的最佳选择。在本文中，我们提出 DetNet。DetNet 的核心思想是设计用于目标检测的更好的 backbone。

## 3 DetNet：一个用于目标检测的 backbone 网络

###  3.1 动机 

- 最近的目标检测器通常使用在 ImageNet 分类数据集上预训练的 backbone 网络。由于 ImageNet 分类任务与目标检测任务有所不同，后者不仅需要识别目标的种类，还要在空间上定位边界框。图片分类问题的设计准则并不适用于定位任务，因为对于标准的图片分类网络，例如 VGG16 和 ResNet，特征映射的空间分辨率在逐渐降低。一些技术，例如 FPN 和扩张，被用于 backbone 网络来保持空间分辨率。然而，在训练这些 backbone 网络时仍旧存在下面三个问题。
  - **网络中阶段数量不同。** 典型的分类网络包含 $5$ 个阶段，每个阶段使用 $2\times$ 的池化或者步长为 $2$ 的卷积对特征映射进行池化。因此，输出的特征映射的空间尺寸是 $32\times$ 降采样的。与传统的分类网络不同，特征金字塔检测器通常采用更多个阶段。
  - **大型目标识别困难。** 含有大量语义信息的特征映射相对于输入图像进行了 $32\times$ 的降采样，扩大了感受范围，导致了在 ImageNet 分类任务上的成功。然而，较大的步长对于目标定位来说是有害的。在 FPN 中，较大目标在更深的层上被生成和预测出，这些目标的边界太模糊以至于无法得到高精度的回归结果。当分类网络中包含了更多阶段时，这种情况可能会愈发严重，因为更多的降采样给目标带来了更大的步长。
  - **小型目标无法识别。** 较大步长的另一个缺点是小型目标的丢失。随着特征映射空间分辨率的降低和大型上下文信息的集成，小型目标的信息将会很容易被削弱。因此，FPN 在较浅的层上预测小型目标。然而，较浅的层上往往只含有低层次的语义信息，这种信息可能不足以用来识别目标的种类。因此，检测器必须通过使用来自更深的层中的高层次表达中的上下文线索，来提高对于小型目标的分类能力。然而，如果小型目标在更深的层中已经丢失，它们的上下文线索也会同时丢失。
- 为了解决这些问题，我们提出了 DetNet，该方法具有以下特点：
  - 阶段数量直接为目标检测而设计。
  - 尽管我们使用了比传统分类网络更多的阶段数量（例如 $6$ 或者 $7$），我们可以保持特征映射的高空间分辨率，同时保持较大的感受范围。
- DetNet 与传统的 backbone 网络，例如 ResNet，相比，存在许多优势。
  - 首先， DetNet 与其他检测器使用的阶段数完全相同，因此像P6这样的额外阶段可以在ImageNet数据集中进行预训练。
  - 其次，得益于最后一个阶段输出的高分辨率特征映射，DetNet 定位目标边界和寻找易丢失的小型目标的能力更强。

### 3.2 DetNet 设计

- 在这一小节中，我们将给出 DetNet 的详细结构。我们采用了 ResNet-50 作为基础，这个网络被广泛应用于目标检测的 backbone 网络。为了与 ResNet-50 进行公平的比较，我们的 DetNet 的 $1,2,3,4$ 阶段与 ResNet-50 完全相同。
- 为目标检测构建一个高效且有效的 backbone 存在两个挑战。
  - 一方面，在深度神经网络上保持较高的空间分辨率需要消耗大量的时间和内存。
  - 另一方面，减小降采样因子等同于降低有效感受范围，这对于许多视觉任务来说是有害的，例如图像分类和语义分割。
- DetNet 进行了认真地设计来解决这两个挑战。特别地，DetNet 在 $1-4$ 阶段上与 ResNet 采用相同的配置，不同之处从第 $5$ 阶段开始。让我们讨论 DetNet59 的实现细节，DetNet59 是对 DetNet50 的扩展。类似地，我们的 DetNet 可以轻易地使用更深的层来扩展，例如扩展为 ResNet101。DetNet59 的设计细节如下：
  - 我们在 backbone 中引入了额外的阶段，例如 $P6$ ，这些额外的层在之后被用于目标检测，与 FPN 类似。同时，我们在阶段 $4$ 之后固定空间分辨率为 $16\times$ 降采样。
  - 由于在阶段 $4$ 之后空间分辨率固定，为了引入新的阶段，我们在每个阶段地开始处采用了带有 $1 \times 1$ 卷积投影的扩张瓶颈。我们发现这种模型对于 FPN 等多阶段检测器来说很重要。
  - 我们将扩张瓶颈用作基本的网络块来有效地增加感受范围。由于扩张卷积仍然是耗时的，我们的阶段 $5$ 和阶段 $6$ 保持与阶段 $4$ 相同的通道数（$256$ 路输入通道）。这与传统的 backbone 设计不同，传统设计中通道数在下一层会倍增。
- 将 DetNet 与任意的检测器集成起来都是容易的，无论检测器是否需要特征金字塔。不失代表性，我们采用优秀的检测器 FPN 作为基准来验证 DetNet 的效果。由于 DetNet 仅改变了 FPN 的 basebone，我们固定 FPN 中的其他结构。因为我们在阶段 $4$ 之后不再降低空间尺寸，我们将这些阶段的输出按照从上到下的顺序进行简单地求和。

## 4 实验

## 5 结论

- 内容与摘要基本一致。